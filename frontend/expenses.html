<!--HEADER COPY START HERE-->
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Expenses</title>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <!-- <link rel="stylesheet" href="{{ url_for('serve_css', filename='styles.css')}}"> -->
        <!-- <script src="{{ url_for('serve_js', filename='script.js') }}"></script> -->

        <!-- CSS here for now -->
        <style>
            /* -------- Universal Root Start -------- */
            :root {
                --bg: #f3f6fb;
                --panel: #ffffff;
                --accent: #1062cd;
                --accent-2: #083880;
                --muted: #8b94a6;
                --card_shadow: 0 6px 18px rgba(32, 41, 78, 0.06);
            }
            * {
                box-sizing: border-box;
            }
            body {
                margin: 0;
                font-family:
                    Inter,
                    ui-sans-serif,
                    system-ui,
                    -apple-system,
                    'Segoe UI',
                    Roboto,
                    'Helvetica Neue',
                    Arial;
                background: linear-gradient(180deg, var(--bg), var(--panel));
                color: #111;
            }
            /* -------- Universal Root End -------- */

            /* -------- Dashboard Start -------- */
            .dashboard {
                display: flex;
                min-height: 100vh;
                gap: 24px;
                padding: 28px 28px 28px 0;
                align-items: stretch;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                width: 260px;
                padding: 32px 28px;
                background: linear-gradient(
                    180deg,
                    var(--accent),
                    var(--accent-2)
                );
                color: #fff;
                display: flex;
                flex-direction: column;
                gap: 18px;
                z-index: 50;
                flex-shrink: 0;
            }

            .budget_name {
                font-weight: 700;
            }

            .balance {
                font-size: 20px;
                opacity: 0.9;
            }

            .nav {
                display: flex;
                flex-direction: column;
                gap: 12px;
                margin-top: 6px;
            }

            .nav a {
                color: rgba(255, 255, 255, 0.9);
                text-decoration: none;
                display: flex;
                gap: 10px;
                align-items: center;
                padding: 8px 10px;
                border-radius: 10px;
            }

            .nav a.active {
                background: rgba(255, 255, 255, 0.08);
            }

            .main {
                margin-left: 280px;
                display: flex;
                flex-direction: column;
                gap: 18px;
                min-width: 0;
                padding-right: 28px;
                flex: 1;
                max-width: 100vw;
                box-sizing: border-box;
            }

            @media (max-width: 1800px) {
                .sidebar {
                    position: static;
                    width: 220px;
                    border-radius: 20px;
                    padding: 28px;
                }
                .main {
                    margin-left: 0;
                    padding-right: 16px;
                }
                .dashboard {
                    flex-direction: column;
                    padding: 16px;
                }
            }

            /* -------- Dashboard End -------- */

           /* -------- Expenses Styling (to match Income) -------- */
            .expenseStats {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 18px;
                margin-bottom: 24px;
            }

            .stat-card {
                background: var(--panel);
                border-radius: 14px;
                padding: 18px;
                box-shadow: var(--card_shadow);
                display: flex;
                flex-direction: column;
            }

            .stat-icon {
                width: 40px;
                height: 40px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 12px;
                font-size: 18px;
            }

            .stat-1 .stat-icon {
                background: #fee2e2;
                color: #ef4444;
            }
            .stat-2 .stat-icon {
                background: #fff4e6;
                color: #f59e0b;
            }
            .stat-3 .stat-icon {
                background: #e0e7ff;
                color: #4f46e5;
            }

            .stat-value {
                font-size: 22px;
                font-weight: 700;
                margin: 8px 0;
            }

            .stat-title {
                color: var(--muted);
                font-size: 14px;
            }

            .expenseHeader {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 24px;
                padding: 16px 0;
            }

            .list-controls {
                display: flex;
                gap: 12px;
                align-items: center;
            }

            .search-box {
                padding: 8px 12px;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                font-size: 14px;
            }

            .sort-select {
                padding: 8px 12px;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                font-size: 14px;
                background: white;
            }

            .expenseContainer {
                background: var(--panel);
                border-radius: 14px;
                padding: 24px;
                box-shadow: var(--card_shadow);
                margin-bottom: 24px;
            }

            .expenseTable {
                width: 100%;
                border-collapse: collapse;
            }

            .expenseTable th {
                text-align: left;
                padding: 12px;
                border-bottom: 2px solid #e2e8f0;
                font-weight: 600;
                color: var(--muted);
                background: var(--panel);
            }

            .expenseTable td {
                padding: 12px;
                border-bottom: 1px solid #e2e8f0;
            }

            .addExpenseButton {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 10px 16px;
                border-radius: 8px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s ease;
                border: none;
                font-size: 14px;
                background-color: var(--accent);
                color: #fff;
                margin-top: 12px;
                margin-left: 25px;
            }

            #expenseForm {
                background: var(--panel);
                border-radius: 14px;
                padding: 24px;
                box-shadow: var(--card_shadow);
                margin-bottom: 24px;
                display: flex;
                flex-direction: column;
                gap: 16px;
                max-width: 400px;
            }

            #expenseForm label {
                display: flex;
                flex-direction: column;
                font-size: 14px;
                font-weight: 500;
                color: var(--muted);
            }

            #expenseForm .formSub {
                margin-bottom: 6px;
                font-weight: 600;
                color: #111;
                font-size: 14px;
            }

            #expenseForm input,
            #expenseForm select {
                padding: 10px 12px;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                font-size: 14px;
                background: #fff;
                color: #111;
                outline: none;
                transition: border-color 0.2s ease, box-shadow 0.2s ease;
            }

            #expenseForm input:focus,
            #expenseForm select:focus {
                border-color: var(--accent);
                box-shadow: 0 0 0 3px rgba(16, 98, 205, 0.15);
            }

            #expenseForm button[type="submit"] {
                align-self: flex-start;
                padding: 10px 16px;
                border-radius: 8px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s ease;
                border: none;
                font-size: 14px;
                background-color: var(--accent);
                color: #fff;
                margin-top: 10px;
            }

            #expenseForm button[type="submit"]:hover {
                background-color: var(--accent-2);
            }

            @media (max-width: 1024px) {
                .expense-stats {
                    grid-template-columns: 1fr;
                }
                #expenseForm {
                    max-width: 100%;
                }
            }
        </style>
        <!-- CSS here for now -->
    </head>
    <!--HEADER COPY END HERE-->

    <body>
        <div class="dashboard">
            <!--LEFT SIDE BAR STARTS HERE-->
            <aside class="sidebar">
                <div class="budget_name">My Budget</div>
                <div>
                    <div class="balance">Menu</div>
                </div>
                <nav class="nav">
                    <a onclick="location.href='dashboard.html';">Dashboard</a>
                    <a onclick="location.href='budget.html';">Budget</a>
                    <a onclick="location.href='income.html';">Income</a>
                    <a class="active" onclick="location.href='expenses.html';">Expenses</a>
                    <!-- <a href="#">Charts</a> -->
                    <a onclick="location.href='reports';">Reports</a>
                    <a onclick="location.href='schedules';">Schedules</a>
                    <a onclick="location.href='chart.html';">Charts</a>
                    <a onclick="location.href='calendar';">Calendar</a>
                    <a onclick="location.href='messages';">Messages</a>
                    <a onclick="location.href='account';">Settings</a>
                </nav>
            </aside>
            <!--LEFT SIDE BAR END HERE-->

            <main class="main">
                <h1 class="title">Expense Tracking</h1>
                <div class="expenseStats">
                    <div class="stat-card stat-1">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-value" id="stat-total-expense">$0.00</div>
                        <div class="stat-title">Total Monthly Expense</div>
                    </div>
                    <div class="stat-card stat-2">
                        <div class="stat-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-value" id="stat-expected-expense">$0.00</div>
                        <div class="stat-title">Payment This Month</div>
                    </div>
                    <div class="stat-card stat-3">
                        <div class="stat-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="stat-value" id="stat-expense-sources">0</div>
                        <div class="stat-title">Expense Sources</div>
                    </div>
                </div>
                <div class="expenseHeader">
                    <div class="list-controls">
                            <input
                                type="text"
                                class="search-box"
                                placeholder="Search expense..."
                                id="searchExpense"
                            />
                            <select class="sort-select" id="sortExpense">
                                <option value="date-desc">
                                    Sort by: Date (Newest)
                                </option>
                                <option value="date-asc">
                                    Sort by: Date (Oldest)
                                </option>
                                <option value="amount-desc">
                                    Sort by: Amount (High to Low)
                                </option>
                                <option value="amount-asc">
                                    Sort by: Amount (Low to High)
                                </option>
                                <option value="source">
                                    Sort by: Source
                                </option>
                            </select>
                    </div>
                </div>
                <div class="expenseContainer">
                <table class="expenseTable" id="expenseTable">
                    <thead>
                        <tr>
                            <th>Source</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Frequency</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody id="expenseTableBody"></tbody>
                </table>
                </div>
                <button class="addExpenseButton" id="addExpense">+ Add Expense</button>

                <form id="expenseForm" style="display:none; margin-top:20px;">
                    <label>
                        <div class="formSub">Source</div>
                        <input type="text" placeholder="Source" name="Source" required />
                    </label>
                    <label>
                        <div class="formSub">Amount</div>
                        <input type="text" placeholder="Amount" name="Amount" required />
                    </label>
                    <label>
                        <div class="formSub">Date</div>
                        <input type="date" name="date" required />
                    </label>
                    <label>
                        <div class="formSub">Frequency</div>
                        <select name="Frequency" required>
                            <option value="" disabled selected>Select frequency</option>
                            <option value="One-time">One-time</option>
                            <option value="Daily">Daily</option>
                            <option value="Weekly">Weekly</option>
                            <option value="Monthly">Monthly</option>
                            <option value="Yearly">Yearly</option>
                        </select>
                    </label>
                    <label>
                        <div class="formSub">Description</div>
                        <input type="text" placeholder="Description" name="Description" />
                    </label>
                    <label>
                        <button type="submit">Submit</button>
                    </label>
                </form>
            </main>
        </div>
        <script>

            const addExpenseBtn = document.getElementById('addExpense');
            const expenseForm = document.getElementById('expenseForm');
            const searchExpense = document.getElementById('searchExpense');
            const sortExpense = document.getElementById('sortExpense');
            const expenseTableBody = document.getElementById('expenseTableBody');

            let expenses = [];

            addExpenseBtn.onclick = function() {
                if (expenseForm.style.display === 'none' || expenseForm.style.display === '') {
                    expenseForm.style.display = 'block';
                } else {
                    expenseForm.style.display = 'none';
                }
            };

            function loadExpenses() {
                const stored = localStorage.getItem('expenses');
                if (stored) {
                    try {
                        expenses = JSON.parse(stored).map(e => ({
                        source: e.source || '',
                        amount: Number(e.amount || 0),
                        date: e.date || '',
                        frequency: e.frequency || 'One-time',
                        description: e.description || ''
                        }));
                    } catch (err) {
                        console.error('Failed to parse stored expenses', err);
                        expenses = [];
                    }
                }
                // Placeholder for loading expenses from a backend or local storage
                // It loads this if no info is found in local storage
                // Remove this when there is actual backend implementation with the database
                else {
                    expenses = [
                        { source: 'Rent', amount: 1200, date: '2024-06-01', frequency: 'Monthly', description: 'June Rent' },
                        { source: 'Groceries', amount: 300, date: '2024-06-05', frequency: 'Weekly', description: 'Weekly groceries' },
                        { source: 'Utilities', amount: 150, date: '2024-06-03', frequency: 'Monthly', description: 'Electricity and water' },
                    ];
                    localStorage.setItem('expenses', JSON.stringify(expenses));
                }
                renderExpenses();
            }

            function renderExpenses() {
                expenseTableBody.innerHTML = '';
                expenses.forEach((expense, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.source}</td>
                        <td>$${expense.amount.toFixed(2)}</td>
                        <td>${expense.date}</td>
                        <td>${expense.frequency}</td>
                        <td>${expense.description || ''}</td>
                    `;
                    expenseTableBody.appendChild(row);
                });
                updateCards();
            }

            function formSubmission() {
                event.preventDefault();
                const formData = new FormData(expenseForm);

                const source = formData.get('Source');
                const amount = parseFloat(formData.get('Amount'));
                const date = formData.get('date');
                const frequency = formData.get('Frequency');
                const description = formData.get('Description');

                expenses.push({ source, amount, date, frequency, description });

                localStorage.setItem('expenses', JSON.stringify(expenses));

                renderExpenses();
                expenseForm.reset();
                expenseForm.style.display = 'none';
            };

            function searchExpenses() {
                const filter = searchExpense.value.toLowerCase();
                const rows = expenseTableBody.querySelectorAll('tr');

                rows.forEach(row => {
                    const [source, amount, date, frequency, description] = Array.from(row.cells).map(c => c.textContent.toLowerCase());

                    row.style.display = 
                        (source.includes(filter) || amount.includes(filter) || date.includes(filter) || frequency.includes(filter) || description.includes(filter))
                        ? '' 
                        : 'none';
                });
            };

            function sortExpenses() {
                const criteria = sortExpense.value;
                expenses.sort((a, b) => {
                    switch (criteria) {
                        case 'date-desc':
                            return new Date(b.date) - new Date(a.date);
                        case 'date-asc':
                            return new Date(a.date) - new Date(b.date);
                        case 'amount-desc':
                            return b.amount - a.amount;
                        case 'amount-asc':
                            return a.amount - b.amount;
                        case 'source':
                            return a.source.localeCompare(b.source);
                        default:
                            return 0;
                    }
                });
                renderExpenses();
            }

            function updateCards() {
                const frequencyMap = {
                    "One-time": 1,
                    "Daily": 30,
                    "Weekly": 4,
                    "Monthly": 1,
                    "Yearly": 1/12
                };

                // Calculate total monthly expense minus any one time expenses
                const totalMonthly = expenses.reduce((sum, e) => {
                    const freq = frequencyMap[e.frequency] || 0;
                    return sum + (parseFloat(e.amount) * freq);
                }, 0);

                const expectedThisMonth = expenses.reduce((sum, e) => {
                    const date = new Date(e.date);
                    const now = new Date();
                    const sameMonth = date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
                    if (sameMonth) {
                        return sum + parseFloat(e.amount);
                    }
                    return sum;
                }, 0);


                const sources = new Set(expenses.map(e => e.source));
                const numSources = sources.size;

                document.getElementById('stat-total-expense').textContent = `$${totalMonthly.toFixed(2)}`;
                document.getElementById('stat-expected-expense').textContent = `$${expectedThisMonth.toFixed(2)}`;
                document.getElementById('stat-expense-sources').textContent = numSources;
            }

            function addTestExpense() {

                const randomAmount = (Math.random() * 1000 + 10).toFixed(2);

                const now = new Date();
                const daysAgo = Math.floor(Math.random() * 90);
                const randomDate = new Date(now.getTime() - daysAgo * 24 * 60 * 60 * 1000);
                const dateStr = randomDate.toISOString().split('T')[0];

                const testExpense = {
                    source: 'Test Source',
                    amount: parseFloat(randomAmount),
                    date: dateStr,
                    frequency: 'Monthly',
                    description: 'Test expense'
                };
                expenses.push(testExpense);
                localStorage.setItem('expenses', JSON.stringify(expenses));
                renderExpenses();
            }

            function clearExpenses() {
                localStorage.removeItem('expenses');
                expenses = [];
                renderExpenses();
                updateCards();
            }

            sortExpense.onchange = sortExpenses;
            searchExpense.oninput = searchExpenses;
            expenseForm.onsubmit = formSubmission;

            document.addEventListener('keydown', function(e) {
                if (e.key === '[') {
                    addTestExpense();
                }
                if (e.key === ']') {
                    clearExpenses();
                }
            });

            loadExpenses();
        </script>
    </body>
</html>
